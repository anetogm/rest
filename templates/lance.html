<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Fazer Lance</title>
  </head>
  <body>
    <h1>Fazer Lance em Leilão</h1>
    <form id="lanceForm">
      <label for="leilaoId">ID do Leilão:</label>
      <input type="number" id="leilaoId" required /><br /><br />
      <label for="valorLance">Valor do Lance:</label>
      <input type="number" step="0.01" id="valorLance" required /><br /><br />
      <button type="button" onclick="fazerLance()">Enviar Lance</button>
    </form>
    <p id="resultado"></p>
    <a href="/">Voltar à Página Inicial</a>

    <script>
      let baseUrl = "http://localhost:4444/";

      function getUserIdFromSessionStorage() {
        let userId = sessionStorage.getItem("userId");
        if (!userId) {
          userId = crypto.randomUUID();
          sessionStorage.setItem("userId", userId);
        }
        return userId;
      }

      async function fazerLance() {
        const leilaoId = document.getElementById("leilaoId").value;
        const valorLance = document.getElementById("valorLance").value;
        const userId = getUserIdFromSessionStorage();

        if (!leilaoId || !valorLance) {
          document.getElementById("resultado").textContent =
            "Preencha todos os campos.";
          return;
        }

        try {
          const res = await fetch(baseUrl + "lance", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              leilao_id: leilaoId,
              user_id: userId,
              valor: parseFloat(valorLance),
            }),
          });
          const result = await res.json();
          document.getElementById("resultado").textContent =
            result.message || "Lance enviado!";
        } catch (e) {
          document.getElementById("resultado").textContent =
            "Erro ao fazer lance: " + e.message;
        }
      }
    </script>
  </body>
</html>
